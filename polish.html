<!doctype html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>AgeFinder</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            flex-direction: column;
        }
        /* Extra large devices (large laptops and desktops, 1200px and up) */
        @media only screen and (min-width: 1200px) {

            .label,
            #date,
            #age {
                font-size: 42px;
            }
        }
    </style>
</head>
<body>
<img id="arrow" src="arrow.png" style="display: none;">
<canvas id="canvas" width="350%" height="570px"></canvas>
<div style="display: flex; flex-direction: column;justify-content: flex-end;">
    <div class="label">Wprowadź datę urodzenia:</div>
    <input id="date" type="date" style="text-align: center;">
    <div id="age" style="width: 200%;">Nieprawidłowa data.</div>
</div>
<img id="changeToEnglish" src="unitedStatesFlag.jpg" style="position: fixed; bottom: 0;left: 0;cursor: pointer;width: 3%;">
<script>
    document.getElementById(`changeToEnglish`).addEventListener(`click`, function () {
        window.location.href = `index.html`
    })
    arrowY = 0
    direction = 1
    maxY = 10
    minY = -100

    function animateArrow() {
        canvas = document.getElementById("canvas")
        contex = canvas.getContext("2d")
        arrow = document.getElementById("arrow")
        contex.clearRect(0, 0, canvas.width, canvas.height);
        if (arrow.complete && arrow.naturalWidth != 0) {
            contex.drawImage(arrow, 0, arrowY);
        }
        arrowY += direction * 2
        if (arrowY >= maxY || arrowY <= minY) {
            direction *= -1
        }
        requestAnimationFrame(animateArrow)
    }

    window.addEventListener("DOMContentLoaded", function () {
        arrow = document.getElementById("arrow")
        if (arrow.complete && arrow.naturalWidth != 0) {
            animateArrow()
        } else {
            arrow.addEventListener("load", function () {
                animateArrow()
            })
        }
    })
    function calculateAge() {
        let birthDate = new Date(document.getElementById("date").value);
        if (birthDate.toString() === "Invalid Date") {
            document.getElementById("age").textContent = "Nieprawidłowa data.";
            return;
        }
        let today = new Date();
        let years = today.getFullYear() - birthDate.getFullYear();
        let months = today.getMonth() - birthDate.getMonth();
        let days = today.getDate() - birthDate.getDate();
        if (days < 0) {
            months--;
            days += new Date(today.getFullYear(), today.getMonth(), 0).getDate();
        }
        if (months < 0) {
            years--;
            months += 12;
        }
        document.getElementById("age").textContent = `Obliczony wiek to ${years} lat i ${months} miesiące i ${days} dni.`
    }

    document.getElementById("date").addEventListener("change", calculateAge);

    function setMidnightInterval() {
        function calculateNextMidnight() {
            let now = new Date();
            let midnight = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
            return midnight - now;
        }

        function setDailyInterval() {
            const timeToMidnight = calculateNextMidnight();
            setTimeout(function () {
                calculateAge();
                setDailyInterval();
            }, timeToMidnight);
        }

        setDailyInterval();
    }

    setMidnightInterval();
</script>
</body>
</html>
